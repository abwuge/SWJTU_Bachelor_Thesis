\ProvidesPackage{style/swjtu}[SWJTU Thesis Style]

%%% ======================= 版面 ======================= %%%
\RequirePackage{geometry}
\geometry{
  paper=a4paper,
  left=2.7cm, right=2.7cm,
  top=2.6cm, bottom=2.6cm
}

%%% ======================= 字体 ======================= %%%
%%% --------------------- 默认字体 --------------------- %%%
\setmainfont[
  Path=fonts/,
  UprightFont=TIMES,
  BoldFont=TIMESBD,
  ItalicFont=TIMESI,
  BoldItalicFont=TIMESBI
]{Times New Roman}
\setCJKmainfont[
  Path=fonts/,
  AutoFakeBold,
  AutoFakeSlant
]{simsun.ttc}
\setCJKmonofont[
  Path=fonts/,
  AutoFakeBold,
  AutoFakeSlant
]{simsun.ttc}

%%% --------------------- 中文字体 --------------------- %%%
\setCJKfamilyfont{songti}[
  Path=fonts/,
  AutoFakeBold,
  AutoFakeSlant
]{simsun.ttc}
\newcommand{\songti}{\CJKfamily{songti}}

\setCJKfamilyfont{heiti}[
  Path=fonts/,
  AutoFakeBold,
  AutoFakeSlant
]{simhei.ttf}
\newcommand{\heiti}{\CJKfamily{heiti}}

%%% --------------------- 英文字体 --------------------- %%%
\newfontfamily{\ensongti}[
  Path=fonts/,
  AutoFakeBold,
  AutoFakeSlant
]{simsun.ttc}
\newfontfamily{\enheiti}[
  Path=fonts/,
  AutoFakeBold,
  AutoFakeSlant
]{simhei.ttf}

%%% ------------------- 统一字体环境 ------------------- %%%
\RequirePackage{environ}
\NewEnviron{allsongti}{
  {\songti\ensongti\BODY}
}
\NewEnviron{allheiti}{
  {\heiti\enheiti\BODY}
}

%%% ===================== 排版策略 ===================== %%%
%%% ----------------- 微调字间距和伸缩 ------------------ %%%
\RequirePackage{microtype}

%%% ----------------------- 断行 ----------------------- %%%
\RequirePackage{etoolbox}
\pretocmd{\section}{\sloppy}{}{}
\pretocmd{\subsection}{\sloppy}{}{}
\pretocmd{\subsubsection}{\sloppy}{}{}
\pretocmd{\paragraph}{\sloppy}{}{}
\pretocmd{\subparagraph}{\sloppy}{}{}
\sloppy

%%% ===================== 页眉页脚 ===================== %%%
\RequirePackage{fancyhdr}
\pagestyle{fancy}

%%% ----------------------- 页眉 ----------------------- %%%
\fancyhead[L]{}
\fancyhead[C]{
  \begin{allheiti}
    西南交通大学本科毕业设计(论文)
  \end{allheiti}
}
\fancyhead[R]{}
\renewcommand{\headrulewidth}{0.8mm}
\setlength{\headheight}{14.45398pt}

%%% ----------------------- 页脚 ----------------------- %%%
\fancyfoot[C]{
  \heiti
  第\thepage 页
}
\renewcommand{\footrulewidth}{0pt}

%%% ===================== 参考文献 ===================== %%%
\RequirePackage[
  style=gb7714-2015
]{biblatex}
\addbibresource{bibliography/references.bib}

%%% ===================== 公式图表 ===================== %%%
\RequirePackage{caption}
\renewcommand{\theequation}{\thechapter-\arabic{equation}}
\renewcommand{\thefigure}{\thechapter-\arabic{figure}}
\renewcommand{\thetable}{\thechapter-\arabic{table}}
\captionsetup[figure]{labelsep=space}
\captionsetup[table]{labelsep=space}

%%% =================== 其他页面设置 =================== %%%
\ctexset{
  chapter = {
    number = \arabic{chapter},
    format = \zihao{-2} \heiti \centering,
    pagestyle = fancy,
    beforeskip = 0pt,
    afterskip = \baselineskip,
   },
  section = {
    format = \zihao{-3} \heiti \raggedright,
    beforeskip = {\ifx\lastskip\parskip 12pt \else 0pt \fi},
    afterskip = 12pt,
   },
  subsection = {
      format = \zihao{4} \heiti \raggedright,
      beforeskip = {\ifx\lastskip\parskip 6pt \else 0pt \fi},
      afterskip = 6pt,
    },
  subsubsection = {
      format = \zihao{-4} \heiti \raggedright,
      beforeskip = 0pt,
      afterskip = 0pt,
    },
}
\raggedbottom % 避免强制拉伸

%%% ======================= 杂项 ======================= %%%
%%% --------------------- 常用宏包 --------------------- %%%
\RequirePackage{amssymb}    % 数学符号
\RequirePackage{changepage} % 页边距
\RequirePackage{graphicx}   % 插入图片
\RequirePackage{physics}    % 物理符号
\RequirePackage{setspace}   % 行距
\RequirePackage{tocloft}    % 目录
\RequirePackage{xkeyval}    % key-value 参数
\RequirePackage{xparse}     % 变长参数命令

%%% ---------------------- 超链接 ---------------------- %%%
\RequirePackage[
  colorlinks=false,
  hidelinks,
]{hyperref}

\RequirePackage[nameinlink]{cleveref}
\crefname{equation}{式}{式}
\crefrangeformat{equation}{式(#3#1#4)到(#5#2#6)}
\crefmultiformat{equation}{式#2#1#3}{和#2#1#3}{、#2#1#3}{和#2#1#3}

\crefname{figure}{图}{图}
\crefrangeformat{figure}{图#3#1#4到#5#2#6}
\crefmultiformat{figure}{图#2#1#3}{和#2#1#3}{、#2#1#3}{和#2#1#3}

\crefname{table}{表}{表}
\crefrangeformat{table}{表#3#1#4到#5#2#6}
\crefmultiformat{table}{表#2#1#3}{和#2#1#3}{、#2#1#3}{和#2#1#3}

%%% ---------------------- 下划线 ---------------------- %%%
\RequirePackage{xeCJKfntef}
\renewcommand{\underline}{\CJKunderline[skip=false]}

%%% ----------------------- 列表 ----------------------- %%%
\RequirePackage{enumitem}
\newlist{explainSymbol}{itemize}{1}
\setlist[description]{
  labelindent=2em,
  labelsep=1em,
  leftmargin=0pt,
  nosep,
}
\setlist[explainSymbol]{
  font=\normalfont,
  labelindent=2em,
  labelsep=0pt,
  leftmargin=!,
  align=parleft,
  nosep
}

%%% ------------------------ 表格 ---------------------- %%%
\RequirePackage{booktabs}
\RequirePackage{subcaption}
\RequirePackage{tabularx}
\newcolumntype{L}{>{\raggedright\arraybackslash}X}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}

%%% ----------------------- 符号 ----------------------- %%%
\newcommand{\boxsurd}{ % 复选框：已选中
  \rlap{\(\Box\)}{\raisebox{0.1em}{\hspace{-0.1em}\(\surd\)}}
}

%%% ---------------------- 干净页 ----------------------- %%%
\newenvironment{cleanpage}{ % 区别于titlepage book类双面打印导致的空白偶数页
  \clearpage
  % \thispagestyle{empty}
}{
  \clearpage
}

\makeatletter
%%% ===================== 公式注释 ===================== %%%
\newcounter{swjtu@itemCount}
\newcounter{swjtu@currentIndex}
\newlength{\swjtu@labelwidth}

\newcommand{\swjtu@countItem}[1]{\IfBlankF{#1}{\stepcounter{swjtu@itemCount}}}
\newcommand{\swjtu@stepCurrent}{\stepcounter{swjtu@currentIndex}}

\NewDocumentCommand{\swjtuExplanation}{>{\SplitList{;}} m}{%
  \setcounter{swjtu@itemCount}{0}
  \setcounter{swjtu@currentIndex}{0}%
  \ProcessList{#1}{\swjtu@countItem}%
  \ProcessList{#1}{\swjtu@splitSymbolAndExplanationPair}%
}

\NewDocumentCommand{\swjtu@splitSymbolAndExplanationPair}{>{\SplitArgument{1}{,}} m}{%
  \swjtu@stepCurrent%
  \ifnum\value{swjtu@currentIndex}>\value{swjtu@itemCount}
  \else
  \swjtu@explainSymbol #1%
  \fi
}

\NewDocumentCommand{\swjtu@explainSymbol}{mm}{%
  \settowidth{\swjtu@labelwidth}{\hspace{6em}#1}
  \begin{explainSymbol}[labelwidth=\swjtu@labelwidth]
    \ifnum\value{swjtu@currentIndex}=1
    \swjtu@explainItem{式中\hspace{2em}#1——}{#2}
    \else
    \swjtu@explainItem{\hspace{4em}#1——}{#2}
    \fi
  \end{explainSymbol}
}

\newcommand{\swjtu@explainItem}[2]{
  \ifnum\value{swjtu@currentIndex}<\value{swjtu@itemCount}
    \item[#1] #2；
  \else
    \item[#1] #2。
  \fi
}

%%% ======================= 扉页 ======================= %%%
%%% --------------------- 参数定义 --------------------- %%%
\define@key[swjtu]{titlePage}{ctitle}{\def\swjtu@ctitle{#1}}
\define@key[swjtu]{titlePage}{etitle}{\def\swjtu@etitle{#1}}
\define@key[swjtu]{titlePage}{grade}{\def\swjtu@grade{#1}}
\define@key[swjtu]{titlePage}{id}{\def\swjtu@id{#1}}
\define@key[swjtu]{titlePage}{name}{\def\swjtu@name{#1}}
\define@key[swjtu]{titlePage}{major}{\def\swjtu@major{#1}}
\define@key[swjtu]{titlePage}{advisor}{\def\swjtu@advisor{#1}}
\define@key[swjtu]{titlePage}{year}{\def\swjtu@year{#1}}
\define@key[swjtu]{titlePage}{month}{\def\swjtu@month{#1}}

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuTitlePage}[1][]{%
  \def\swjtu@ctitle{}
  \def\swjtu@etitle{}
  \def\swjtu@grade{}
  \def\swjtu@id{}
  \def\swjtu@name{}
  \def\swjtu@major{}
  \def\swjtu@advisor{}
  \def\swjtu@year{}
  \def\swjtu@month{}
  \setkeys[swjtu]{titlePage}{#1}

  \begin{titlepage}
    \onehalfspacing \zihao{5}

    \begin{center}
      % 空行 * 3
      ~\\ \vspace{2\baselineskip}

      % 标题
      \begin{allheiti} \doublespacing \zihao{-2}
        西\hspace{0.5em}南\hspace{0.5em}交\hspace{0.5em}通\hspace{0.5em}大\hspace{0.5em}学\strut\\
        本科毕业设计（论文）
      \end{allheiti}

      % 空行 * 3
      \vspace{3\baselineskip}

      % 中英文题目
      \begin{allheiti} \singlespacing \zihao{2}
        \swjtu@ctitle\strut\\
        \MakeUppercase{\swjtu@etitle}
      \end{allheiti}

      % 空行 * 7
      \vspace{7\baselineskip}

      % 个人信息
      \begin{allheiti}
        \begin{tabular}{l}
          年\hspace{2em}级:~\swjtu@grade \\
          学\hspace{2em}号:~\swjtu@id    \\
          姓\hspace{2em}名:~\swjtu@name  \\
          专\hspace{2em}业:~\swjtu@major \\
          指导老师:~\swjtu@advisor
        \end{tabular}
      \end{allheiti}

      % 空行 * 13
      \vspace{13\baselineskip}

      % 日期
      \begin{allsongti}
        \swjtu@year\:年\:\swjtu@month\:月
      \end{allsongti}
    \end{center}
  \end{titlepage}

  % 空白页
  \newpage
  \thispagestyle{empty}
  \mbox{}
}

%%% =================== 学术诚信声明 =================== %%%
%%% --------------------- 参数定义 --------------------- %%%
\define@key[swjtu]{integrity}{signature}{\def\swjtu@signature{#1}}
\define@key[swjtu]{integrity}{year}{\def\swjtu@year{#1}}
\define@key[swjtu]{integrity}{month}{\def\swjtu@month{#1}}
\define@key[swjtu]{integrity}{day}{\def\swjtu@day{#1}}

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuIntegrityDeclaration}[1][]{%
  \def\swjtu@signature{}
  \def\swjtu@year{}
  \def\swjtu@month{}
  \def\swjtu@day{}
  \setkeys[swjtu]{integrity}{#1}

  \begin{cleanpage}
    \doublespacing \zihao{4}

    % 标题
    \begin{center}
      \begin{allheiti} \onehalfspacing \zihao{-2}
        \textbf{西南交通大学}\strut\\
        \textbf{本科毕业设计（论文）学术诚信声明}
      \end{allheiti}
    \end{center}

    % 空行
    \vspace{\baselineskip}

    % 正文
    本人郑重声明：所呈交的毕业设计（论文），是本人在导师的指导下，独立进行研究工作所取得的成果。除文中已经注明引用的内容外，本论文不包含任何其他个人或集体已经发表或撰写过的作品成果。对本文的研究做出重要贡献的个人和集体，均已在文中以明确方式标明。本人完全意识到本声明的法律结果由本人承担。

    % 空行 * 3
    \vspace{3\baselineskip}

    % 签名
    {\noindent \hspace*{0.5\linewidth}
      作者签名：%
      \ifx\swjtu@signature\@empty\else
        \raisebox{-0.5\baselineskip}{\includegraphics[height=1.5\baselineskip]{\swjtu@signature}}
      \fi
    }

    % 空行
    \vspace{\baselineskip}

    % 日期
    \begin{allsongti} \zihao{4}
      \noindent \hspace*{0.5\linewidth}
      日期：\swjtu@year~年~\swjtu@month~月~\swjtu@day~日
    \end{allsongti}
  \end{cleanpage}
}

%%% =================== 版权使用授权 =================== %%%
%%% --------------------- 参数定义 --------------------- %%%
\define@key[swjtu]{copyright}{confidentialityPeriod}{\def\swjtu@confidentialityPeriod{#1}}
\define@key[swjtu]{copyright}{authorSignature}{\def\swjtu@authorSignature{#1}}
\define@key[swjtu]{copyright}{advisorSignature}{\def\swjtu@advisorSignature{#1}}
\define@key[swjtu]{copyright}{authorYear}{\def\swjtu@authorYear{#1}}
\define@key[swjtu]{copyright}{authorMonth}{\def\swjtu@authorMonth{#1}}
\define@key[swjtu]{copyright}{authorDay}{\def\swjtu@authorDay{#1}}
\define@key[swjtu]{copyright}{advisorYear}{\def\swjtu@advisorYear{#1}}
\define@key[swjtu]{copyright}{advisorMonth}{\def\swjtu@advisorMonth{#1}}
\define@key[swjtu]{copyright}{advisorDay}{\def\swjtu@advisorDay{#1}}

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuCopyrightAuthorization}[1][]{%
  \def\swjtu@confidentialityPeriod{0}
  \def\swjtu@authorSignature{}
  \def\swjtu@advisorSignature{}
  \def\swjtu@authorYear{}
  \def\swjtu@authorMonth{}
  \def\swjtu@authorDay{}
  \def\swjtu@advisorYear{}
  \def\swjtu@advisorMonth{}
  \def\swjtu@advisorDay{}
  \setkeys[swjtu]{copyright}{#1}

  \begin{cleanpage}
    \doublespacing \zihao{4}

    % 标题
    \begin{center}
      \begin{allheiti} \onehalfspacing \zihao{-2}
        \textbf{西南交通大学}\strut\\
        \textbf{本科毕业设计（论文）版权使用授权书}
      \end{allheiti}
    \end{center}

    % 空行
    \vspace{\baselineskip}

    \begin{allsongti} \zihao{4}
      % 正文
      本毕业设计（论文）作者同意学校保留并向国家有关部门或机构送交论文的复印件和电子版，允许论文被查阅和借阅。本人授权西南交通大学可以将本毕业设计（论文）的全部或部分内容编入有关数据库进行检索，可以采用影印、缩印或扫描等复制手段保存和汇编本毕业设计（论文）。

      % 保密
      \ifnum\swjtu@confidentialityPeriod>0
        \hspace{7em}保密\(\boxsurd\)，在~\underline{\hspace{0.5em}\swjtu@confidentialityPeriod\hspace{0.5em}}~年解密后适用本授权书。

        本论文属于

        \hspace{7em}不保密\(\Box\)。
      \else
        \hspace{7em}保密\(\Box\)，在~\underline{\hspace{2em}}~年解密后适用本授权书。

        本论文属于

        \hspace{7em}不保密\(\boxsurd\)。
      \fi

      （请在以上方框内打“\(\surd\)”）
    \end{allsongti}

    % 空行 * 3
    \vspace{3\baselineskip}

    % 签名与日期
    \noindent
    \begin{tabularx}{\linewidth}{@{}XX@{}}
      作者签名：%
      \ifx\swjtu@authorSignature\@empty\else
        \raisebox{-0.5\baselineskip}{
          \includegraphics[height=1.5\baselineskip, width=3cm, keepaspectratio]{\swjtu@authorSignature}
        }
      \fi
       &
      指导教师签名：%
      \ifx\swjtu@advisorSignature\@empty\else
        \raisebox{-0.5\baselineskip}{
          \includegraphics[height=1.5\baselineskip, width=3cm, keepaspectratio]{\swjtu@advisorSignature}
        }
      \fi \\
      ~
       &
      ~   \\
      日期：~\swjtu@authorYear~年~\swjtu@authorMonth~月~\swjtu@authorDay~日
       &
      日期：~\swjtu@advisorYear~年~\swjtu@advisorMonth~月~\swjtu@advisorDay~日
    \end{tabularx}

  \end{cleanpage}
}

%%% ====================== 任务书 ====================== %%%
%%% --------------------- 参数定义 --------------------- %%%
\define@key[swjtu]{task}{class}{\def\swjtu@class{#1}}
\define@key[swjtu]{task}{name}{\def\swjtu@name{#1}}
\define@key[swjtu]{task}{id}{\def\swjtu@id{#1}}
\define@key[swjtu]{task}{issueYear}{\def\swjtu@issueYear{#1}}
\define@key[swjtu]{task}{issueMonth}{\def\swjtu@issueMonth{#1}}
\define@key[swjtu]{task}{issueDay}{\def\swjtu@issueDay{#1}}
\define@key[swjtu]{task}{dueYear}{\def\swjtu@dueYear{#1}}
\define@key[swjtu]{task}{dueMonth}{\def\swjtu@dueMonth{#1}}
\define@key[swjtu]{task}{dueDay}{\def\swjtu@dueDay{#1}}
\define@key[swjtu]{task}{title}{\def\swjtu@title{#1}}
\define@key[swjtu]{task}{purpose}{\def\swjtu@purpose{#1}}
\define@key[swjtu]{task}{tasks}{\def\swjtu@tasks{#1}}
\define@key[swjtu]{task}{requirement}{\def\swjtu@requirement{#1}}
\define@key[swjtu]{task}{weeks}{\def\swjtu@weeks{#1}}
\define@key[swjtu]{task}{partOne}{\def\swjtu@partOne{#1}}
\define@key[swjtu]{task}{partOneWeeks}{\def\swjtu@partOneWeeks{#1}}
\define@key[swjtu]{task}{partTwo}{\def\swjtu@partTwo{#1}}
\define@key[swjtu]{task}{partTwoWeeks}{\def\swjtu@partTwoWeeks{#1}}
\define@key[swjtu]{task}{partThree}{\def\swjtu@partThree{#1}}
\define@key[swjtu]{task}{partThreeWeeks}{\def\swjtu@partThreeWeeks{#1}}
\define@key[swjtu]{task}{partFour}{\def\swjtu@partFour{#1}}
\define@key[swjtu]{task}{partFourWeeks}{\def\swjtu@partFourWeeks{#1}}
\define@key[swjtu]{task}{partFive}{\def\swjtu@partFive{#1}}
\define@key[swjtu]{task}{partFiveWeeks}{\def\swjtu@partFiveWeeks{#1}}
\define@key[swjtu]{task}{partReview}{\def\swjtu@partReview{#1}}
\define@key[swjtu]{task}{partReviewWeeks}{\def\swjtu@partReviewWeeks{#1}}
\define@key[swjtu]{task}{remark}{\def\swjtu@remark{#1}}
\define@key[swjtu]{task}{advisor}{\def\swjtu@advisor{#1}}
\define@key[swjtu]{task}{advisorYear}{\def\swjtu@advisorYear{#1}}
\define@key[swjtu]{task}{advisorMonth}{\def\swjtu@advisorMonth{#1}}
\define@key[swjtu]{task}{advisorDay}{\def\swjtu@advisorDay{#1}}

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuTask}[1][]{%
  \def\swjtu@class{}
  \def\swjtu@name{}
  \def\swjtu@id{}
  \def\swjtu@issueYear{}
  \def\swjtu@issueMonth{}
  \def\swjtu@issueDay{}
  \def\swjtu@dueYear{}
  \def\swjtu@dueMonth{}
  \def\swjtu@dueDay{}
  \def\swjtu@title{}
  \def\swjtu@purpose{}
  \def\swjtu@tasks{}
  \def\swjtu@requirement{}
  \def\swjtu@weeks{}
  \def\swjtu@partOne{}
  \def\swjtu@partOneWeeks{}
  \def\swjtu@partTwo{}
  \def\swjtu@partTwoWeeks{}
  \def\swjtu@partThree{}
  \def\swjtu@partThreeWeeks{}
  \def\swjtu@partFour{}
  \def\swjtu@partFourWeeks{}
  \def\swjtu@partFive{}
  \def\swjtu@partFiveWeeks{}
  \def\swjtu@partReview{}
  \def\swjtu@partReviewWeeks{}
  \def\swjtu@remark{}
  \def\swjtu@advisor{}
  \def\swjtu@advisorYear{}
  \def\swjtu@advisorMonth{}
  \def\swjtu@advisorDay{}
  \setkeys[swjtu]{task}{#1}

  \pagestyle{fancy}

  \begin{cleanpage}
    \pagenumbering{Roman}
  
    % 标题
    \begin{center}
      {\zihao{3} \heiti \textbf{毕业设计（论文）任务书}}
    \end{center}
  
    % 空行
    \vspace{\baselineskip}
  
    \begin{allsongti}
      \setlength{\parindent}{0pt}
      \setlength{\baselineskip}{26pt}
  
      % 班级姓名学号
      \begin{tabularx}{\linewidth}{@{}>{\hsize=1.2\hsize}X>{\hsize=0.9\hsize}X>{\hsize=0.9\hsize}X@{}}
        班\hspace{2em}级\underline{\hspace{0.5em}\swjtu@class\hfill}
          &
        学生姓名\underline{\hspace{0.5em}\swjtu@name\hfill}
          &
        学\hspace{2em}号\underline{\hspace{0.5em}\swjtu@id\hfill}
      \end{tabularx}
  
      % 日期
      发题日期：~\swjtu@issueYear~年~\swjtu@issueMonth~月~\swjtu@issueDay~日
      \hfill
      完成日期：~\swjtu@dueYear~年~\swjtu@dueMonth~月~\swjtu@dueDay~日
  
      % 题目
      题\hspace{2em}目\underline{\hspace{0.5em}\swjtu@title\hfill}
  
      % 1、本设计（论文）的目的、意义
      1、本设计（论文）的目的、意义
      
      \underline{\swjtu@purpose\hfill}
  
      % 2、学生应完成的任务
      2、学生应完成的任务
      
      \underline{\swjtu@tasks\hfill}
  
      % 3、本设计（论文）与本专业的毕业要求达成度如何？（如在知识结构、能力结构、素质结构等方面有哪些有效的训练。）
      3、本设计（论文）与本专业的毕业要求达成度如何？（如在知识结构、能力结构、素质结构等方面有哪些有效的训练。）
  
      \underline{\swjtu@requirement\hfill}
  
      \newpage
  
      % 4、本设计（论文）各部分内容及时间分配
      4、本设计（论文）各部分内容及时间分配（共\underline{\hspace{0.5em}\swjtu@weeks\hspace{0.5em}}周）：
  
      { \setlength{\parindent}{1.5em}
      第一部分\underline{\hspace{0.5em}\swjtu@partOne\hfill} (\swjtu@partOneWeeks~周)
  
      第二部分\underline{\hspace{0.5em}\swjtu@partTwo\hfill} (\swjtu@partTwoWeeks~周)
  
      第三部分\underline{\hspace{0.5em}\swjtu@partThree\hfill} (\swjtu@partThreeWeeks~周)
  
      第四部分\underline{\hspace{0.5em}\swjtu@partFour\hfill} (\swjtu@partFourWeeks~周)
  
      第五部分\underline{\hspace{0.5em}\swjtu@partFive\hfill} (\swjtu@partFiveWeeks~周)
  
      评阅及答辩\underline{\hspace{0.5em}\swjtu@partReview\hfill} (\swjtu@partReviewWeeks~周)%
      }
  
      % 空行
      \vspace{\baselineskip}
  
      % 备注
      备\hspace{2em}注\underline{\hspace{0.5em}\swjtu@remark\hfill}
  
      % 空行
      \vspace{\baselineskip}
  
      % 指导教师与日期
      指导教师：\underline{\makebox[5em][l]{\hspace{0.5em}\swjtu@advisor}}\hspace{2em}~\swjtu@advisorYear~年~\swjtu@advisorMonth~月~\swjtu@advisorDay~日\par
    \end{allsongti}
  \end{cleanpage}
}

%%% ===================== 中文摘要 ===================== %%%
%%% --------------------- 参数定义 --------------------- %%%
\define@key[swjtu]{abstractCN}{abstract}{\def\swjtu@abstractCN{#1}}
\define@key[swjtu]{abstractCN}{keywords}{\def\swjtu@keywordsCN{#1}}

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuAbstractCN}[1][]{%
  \def\swjtu@abstractCN{}
  \def\swjtu@keywordsCN{}
  \setkeys[swjtu]{abstractCN}{#1}

  \begin{titlepage}
    % 标题
    \begin{center}
      {\zihao{-2} \heiti 摘\hspace{3em}要}
    \end{center}
  
    % 空行
    \vspace{\baselineskip}
  
    % 摘要正文
    \swjtu@abstractCN
  
    % 空行
    \vspace{\baselineskip}
  
    % 关键词
    {\heiti
      \noindent
      关键词：\hspace{1em}\swjtu@keywordsCN
    }
    
  \end{titlepage}
}

%%% ===================== 英文摘要 ===================== %%%
%%% --------------------- 参数定义 --------------------- %%%
\define@key[swjtu]{abstractEN}{abstract}{\def\swjtu@abstractEN{#1}}
\define@key[swjtu]{abstractEN}{keywords}{\def\swjtu@keywordsEN{#1}}

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuAbstractEN}[1][]{%
  \def\swjtu@abstractEN{}
  \def\swjtu@keywordsEN{}
  \setkeys[swjtu]{abstractEN}{#1}

  \begin{cleanpage}

    % 标题
    \begin{center}
      \zihao{-2} Abstract
    \end{center}

    % 空行
    \vspace{\baselineskip}

    % 摘要正文
    \swjtu@abstractEN

    % 空行
    \vspace{\baselineskip}

    % 关键词
    \noindent
    Key words:\hspace{1em}\swjtu@keywordsEN
  \end{cleanpage}
}

%%% ======================= 目录 ======================= %%%
%%% ------------------- 去除自带标题 ------------------- %%%
\renewcommand{\contentsname}{}
\setlength{\cftbeforetoctitleskip}{0pt}
\setlength{\cftaftertoctitleskip}{0pt}

%%% --------------------- 条目字体 --------------------- %%%
% 章目录项
\renewcommand{\cftchapfont}{\heiti}         % 标题
\renewcommand{\cftchappagefont}{\rmfamily}   % 页码

% 节目录项
\renewcommand{\cftsecfont}{\songti}         % 标题
\renewcommand{\cftsecpagefont}{\rmfamily}    % 页码

% 子节目录项
\renewcommand{\cftsubsecfont}{\songti}      % 标题
\renewcommand{\cftsubsecpagefont}{\rmfamily} % 页码

%%% -------------------- 编号盒宽度 -------------------- %%%
\setlength{\cftchapnumwidth}{0em}    % 章
\setlength{\cftsecnumwidth}{0em}     % 节
\setlength{\cftsubsecnumwidth}{0em}  % 子节

%%% ------------------- 编号标题间隔 ------------------- %%%
\renewcommand{\cftchapaftersnum}{\hspace{0.5em}}   % 章
\renewcommand{\cftsecaftersnum}{\hspace{0.5em}}    % 节
\renewcommand{\cftsubsecaftersnum}{\hspace{0.5em}} % 子节

%%% ----------------------- 缩进 ----------------------- %%%
\setlength{\cftchapindent}{0em}   % 章
\setlength{\cftsecindent}{0em}    % 节
\setlength{\cftsubsecindent}{2em} % 子节

%%% --------------------- 目录间距 --------------------- %%%
\setlength{\cftbeforechapskip}{0pt} % 章

%%% ---------------------- 引导符 ---------------------- %%%
\renewcommand{\cftdotsep}{1}                           % 点线密度
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}} % 章引导符

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuTableOfContents}{%
  \newpage

  % 标题
  \begin{center}
    \heiti 目\hspace{1em}录
  \end{center}

  % 空行
  \vspace{\baselineskip}

  % 正文
  \begin{adjustwidth}{4em}{4em}
    \begin{spacing}{1.5}
      \tableofcontents
    \end{spacing}
  \end{adjustwidth}
  \thispagestyle{fancy}

  % 空白页
  \ifodd\value{page}
    \newpage
    \thispagestyle{empty}
    \mbox{}
  \fi

  % 重置页码
  \clearpage
  \pagenumbering{arabic}
}

%%% ======================= 正文 ======================= %%%
\newcommand{\swjtuIntroduction}[1]{\chapter{#1}} % 绪论章节
\newcommand{\swjtuChapter}[1]{\chapter{#1}}      % 正常章节

%%% ======================= 结论 ======================= %%%
\newcommand{\swjtuConclusion}[1]{%
  \newpage
  \phantomsection % 添加锚点
  \chapter*{#1}
  \addcontentsline{toc}{chapter}{#1} % 添加到目录

  % 修改结论节号格式
  \setcounter{section}{0}
  \renewcommand{\thesection}{\arabic{section}}
}

%%% ======================= 致谢 ======================= %%%
\newcommand{\swjtuAcknowledgments}[1]{\swjtuConclusion{#1}}

%%% ===================== 参考文献 ===================== %%%
\newcommand{\swjtuBibliography}[1]{%
  \newpage
  \phantomsection % 添加锚点
  \printbibliography
  \addcontentsline{toc}{chapter}{#1} % 添加到目录
}

%%% ======================= 附录 ======================= %%%
%%% --------------------- 条件定义 --------------------- %%%
\newif\ifinswjtuappendix
\inswjtuappendixfalse

%%% ----------------------- 命令 ----------------------- %%%
\newcommand{\swjtuAppendix}[1]{%
  \ifinswjtuappendix
    % 已经切换到附录模式
  \else
    % 切换到附录模式
    \ctexset{
      chapter/name = {附录},
    }
    \setcounter{chapter}{0}
    \renewcommand{\thesection}{\thechapter.\arabic{section}}
    \inswjtuappendixtrue
  \fi
  \chapter{#1}
}

\makeatother
